<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Noble Quran App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #00695c; /* Islamic Green */
            --primary-light: #e0f2f1;
            --accent: #cfb53b;  /* Gold */
            --text-dark: #2c3e50;
            --bg-light: #f5f7f9;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-light);
            height: 100vh;
            overflow: hidden; /* App feel */
            margin: 0;
        }

        /* --- Islamic Loader --- */
        #loader-screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: white;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

       .rub-el-hizb {
            position: relative;
            width: 80px;
            height: 80px;
            animation: spin 4s linear infinite;
        }

       .square {
            position: absolute;
            top: 0; left: 0;
            width: 80px; height: 80px;
            border: 6px solid var(--primary);
            border-radius: 8px;
            box-sizing: border-box;
        }

       .square:nth-child(2) {
            transform: rotate(45deg);
        }

       .loading-text {
            margin-top: 30px;
            color: var(--primary);
            font-weight: 600;
            font-size: 1.2rem;
            letter-spacing: 1px;
        }

        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* --- App Layout --- */
       .app-container {
            display: flex;
            height: 100%;
            width: 100%;
            position: relative;
        }

        /* Sidebar / Mobile Main View */
       .surah-sidebar {
            width: 350px;
            background: white;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #ddd;
            z-index: 10;
        }

       .app-header {
            background: var(--primary);
            color: white;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

       .app-header h4 { font-size: 1.1rem; margin: 0; font-weight: 700; }
       .app-header small { opacity: 0.9; font-size: 0.8rem; }

       .search-container {
            padding: 10px;
            background: white;
            border-bottom: 1px solid #eee;
        }

       .search-input {
            width: 100%;
            padding: 10px 15px;
            border-radius: 25px;
            border: 1px solid #ddd;
            background: #f9f9f9;
            outline: none;
            transition: border 0.3s;
        }
       .search-input:focus { border-color: var(--primary); background: white; }

       .surah-list {
            flex: 1;
            overflow-y: auto;
            list-style: none;
            padding: 0;
            margin: 0;
        }

       .surah-item {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background 0.2s;
        }

       .surah-item:hover,.surah-item.active {
            background-color: var(--primary-light);
        }

       .surah-number-badge {
            width: 35px; height: 35px;
            background-color: var(--primary-light);
            color: var(--primary);
            border-radius: 8px;
            display: flex;
            align-items: center; justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
            margin-right: 12px;
            transform: rotate(45deg);
        }
       .surah-number-badge span { transform: rotate(-45deg); }

       .surah-info h6 { margin: 0; font-size: 1rem; color: var(--text-dark); }
       .surah-info p { margin: 0; font-size: 0.8rem; color: #7f8c8d; }
       .surah-arabic-name { font-family: 'Amiri', serif; font-size: 1.4rem; color: var(--primary); }

        /* Reader View */
       .reader-view {
            flex: 1;
            background: var(--bg-light);
            display: flex;
            flex-direction: column;
            position: relative;
        }

       .reader-header {
            height: 60px;
            background: white;
            border-bottom: 1px solid #ddd;
            display: flex;
            align-items: center;
            padding: 0 15px;
            justify-content: space-between;
        }

       .reader-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            padding-bottom: 100px; /* Space for audio player */
        }

        /* Ayah Cards */
       .ayah-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.03);
            border-left: 4px solid transparent;
        }

       .ayah-card.active-ayah {
            background-color: #fbfdfc;
            border-left-color: var(--primary);
            box-shadow: 0 4px 12px rgba(0, 105, 92, 0.15);
        }

       .ayah-arabic {
            font-family: 'Amiri', serif;
            font-size: 1.8rem;
            text-align: right;
            line-height: 2.4;
            color: #000;
            margin-bottom: 15px;
            direction: rtl;
        }

       .ayah-translation {
            font-size: 1rem;
            color: #555;
            line-height: 1.5;
        }

       .ayah-meta {
            font-size: 0.75rem;
            color: #aaa;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Audio Player Bar */
       .audio-player {
            position: absolute;
            bottom: 0; left: 0; right: 0;
            background: white;
            padding: 10px 20px;
            border-top: 1px solid #eee;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
            z-index: 100;
        }

       .play-pause-btn {
            width: 50px; height: 50px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            border: none;
            font-size: 1.2rem;
            display: flex;
            align-items: center; justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 105, 92, 0.3);
        }

        /* --- Mobile Responsive Logic --- */
       .back-button {
            background: none; border: none; font-size: 1.2rem; color: var(--text-dark);
            margin-right: 15px; cursor: pointer; display: none;
        }

        @media (max-width: 768px) {
           .surah-sidebar { width: 100%; position: absolute; height: 100%; transition: 0.3s; }
           .reader-view { width: 100%; position: absolute; height: 100%; transform: translateX(100%); transition: 0.3s; }
            
            /* Class to switch views */
           .show-reader.surah-sidebar { transform: translateX(-100%); }
           .show-reader.reader-view { transform: translateX(0); }
            
           .back-button { display: block; }
           .reader-header h5 { font-size: 1rem; }
        }

       .hidden { display: none!important; }
    </style>
</head>
<body>

    <div id="loader-screen">
        <div class="rub-el-hizb">
            <div class="square"></div>
            <div class="square"></div>
        </div>
        <div class="loading-text">Connecting to Quran Cloud...</div>
        <button id="retry-btn" class="btn btn-outline-danger mt-4 hidden" onclick="initApp()">Retry Connection</button>
    </div>

    <div class="app-container" id="app-container">
        <aside class="surah-sidebar">
            <div class="app-header">
                <h4><i class="fas fa-quran me-2"></i>Al-Quran</h4>
                <small>Digital Mushaf</small>
            </div>
            <div class="search-container">
                <input type="text" id="search-input" class="search-input" placeholder="Search Surah (e.g. Mulk)...">
            </div>
            <ul class="surah-list" id="surah-list">
                </ul>
        </aside>

        <main class="reader-view">
            <div class="reader-header">
                <div class="d-flex align-items-center">
                    <button class="back-button" onclick="closeReader()"><i class="fas fa-arrow-left"></i></button>
                    <div>
                        <h5 class="m-0 fw-bold" id="header-title">Select a Surah</h5>
                        <small class="text-muted" id="header-subtitle"></small>
                    </div>
                </div>
            </div>

            <div class="reader-content" id="reader-content">
                <div class="d-flex flex-column align-items-center justify-content-center h-75 text-muted">
                    <i class="fas fa-book-open fa-3x mb-3" style="color:#ddd;"></i>
                    <p>Select a Surah from the list to begin.</p>
                </div>
            </div>

            <div class="audio-player hidden" id="audio-player">
                <div class="d-none d-md-block">
                    <strong id="audio-title" style="font-size:0.9rem;">Surah Name</strong>
                    <div id="audio-subtitle" style="font-size:0.75rem; color:#666;">Ayah 1</div>
                </div>
                <div class="d-flex align-items-center gap-3 mx-auto mx-md-0">
                    <button class="btn btn-sm btn-light rounded-circle" onclick="prevAyah()"><i class="fas fa-backward"></i></button>
                    <button class="play-pause-btn" id="play-btn" onclick="togglePlay()"><i class="fas fa-play"></i></button>
                    <button class="btn btn-sm btn-light rounded-circle" onclick="nextAyah()"><i class="fas fa-forward"></i></button>
                </div>
            </div>
        </main>
    </div>

    <audio id="main-audio"></audio>

    <script>
        // --- Configuration ---
        const PROXY = "https://api.allorigins.win/raw?url=";
        const API_BASE = "https://api.alquran.cloud/v1";
        
        // --- State ---
        let allSurahs =;
        let currentSurahData =;
        let currentAyahIndex = 0;
        let isPlaying = false;
        
        const audioEl = document.getElementById('main-audio');

        // --- Initialization ---
        window.onload = initApp;

        async function initApp() {
            document.getElementById('retry-btn').classList.add('hidden');
            
            try {
                // Fetch Surah List
                // Using proxy to avoid CORS issues
                const url = `${API_BASE}/surah`;
                const finalUrl = PROXY + encodeURIComponent(url);
                
                const response = await fetch(finalUrl);
                if (!response.ok) throw new Error("Network Error");
                
                const data = await response.json();
                
                if (data.code === 200) {
                    allSurahs = data.data;
                    renderSurahList(allSurahs);
                    document.getElementById('loader-screen').style.display = 'none';
                } else {
                    throw new Error("API Error");
                }
            } catch (error) {
                console.error(error);
                document.querySelector('.loading-text').textContent = "Failed to load data.";
                document.getElementById('retry-btn').classList.remove('hidden');
            }
        }

        // --- Rendering List ---
        function renderSurahList(list) {
            const listEl = document.getElementById('surah-list');
            listEl.innerHTML = list.map(surah => `
                <li class="surah-item" onclick="openSurah(${surah.number}, '${surah.englishName}', '${surah.name}')">
                    <div class="d-flex align-items-center">
                        <div class="surah-number-badge"><span>${surah.number}</span></div>
                        <div class="surah-info">
                            <h6>${surah.englishName}</h6>
                            <p>${surah.englishNameTranslation} • ${surah.numberOfAyahs} Ayahs</p>
                        </div>
                    </div>
                    <div class="surah-arabic-name">${surah.name.replace('سُورَةُ', '').trim()}</div>
                </li>
            `).join('');
        }

        // --- Search Feature ---
        document.getElementById('search-input').addEventListener('keyup', (e) => {
            const term = e.target.value.toLowerCase();
            const filtered = allSurahs.filter(s => 
                s.englishName.toLowerCase().includes(term) |

| 
                s.englishNameTranslation.toLowerCase().includes(term) |

| 
                s.number.toString().includes(term)
            );
            renderSurahList(filtered);
        });

        // --- Open Surah (Reader Logic) ---
        async function openSurah(number, engName, arName) {
            // UI Switch for Mobile
            document.getElementById('app-container').classList.add('show-reader');
            
            // Set Headers
            document.getElementById('header-title').textContent = engName;
            document.getElementById('header-subtitle').textContent = arName;
            
            // Show Local Loader in Reader
            const contentEl = document.getElementById('reader-content');
            contentEl.innerHTML = `
                <div class="d-flex flex-column align-items-center justify-content-center h-100">
                    <div class="spinner-border text-success" role="status"></div>
                    <p class="mt-3 text-muted">Loading Surah...</p>
                </div>
            `;

            try {
                // Fetch Text, Translation, and Audio Info
                // We use 'editions' endpoint to get multiple data sets
                const url = `${API_BASE}/surah/${number}/editions/quran-uthmani,en.sahih,ar.alafasy`;
                const finalUrl = PROXY + encodeURIComponent(url);
                
                const response = await fetch(finalUrl);
                const json = await response.json();

                if (json.code === 200) {
                    const arabic = json.data.ayahs;
                    const trans = json.data.[1]ayahs;
                    const audio = json.data.[2]ayahs;

                    // Merge Data
                    currentSurahData = arabic.map((ayah, index) => ({
                        number: ayah.numberInSurah,
                        text: ayah.text,
                        trans: trans[index].text,
                        audioUrl: audio[index].audio, // Direct CDN link
                        juz: ayah.juz
                    }));

                    renderReader(currentSurahData, number);
                    
                    // Setup Audio
                    document.getElementById('audio-player').classList.remove('hidden');
                    currentAyahIndex = 0;
                    updatePlayerInfo();
                }
            } catch (error) {
                contentEl.innerHTML = `<div class="alert alert-danger m-3">Failed to load content. Check internet.</div>`;
            }
        }

        function renderReader(ayahs, surahNum) {
            const contentEl = document.getElementById('reader-content');
            let html = '';

            // Bismillah Header (skip for Surah 1 and 9)
            if (surahNum!== 1 && surahNum!== 9) {
                html += `<div class="text-center mb-4 font-monospace fs-4">بِسْمِ ٱللّٰهِ الرَّحْمٰنِ الرَّحِيْمِ</div>`;
            }

            html += ayahs.map((ayah, i) => `
                <div class="ayah-card" id="ayah-${i}" onclick="playSpecificAyah(${i})">
                    <div class="ayah-meta">
                        <span>Ayah ${ayah.number}</span>
                        <span>Juz ${ayah.juz}</span>
                    </div>
                    <div class="ayah-arabic">${ayah.text}</div>
                    <div class="ayah-translation">${ayah.trans}</div>
                </div>
            `).join('');

            contentEl.innerHTML = html;
            contentEl.scrollTop = 0;
        }

        function closeReader() {
            document.getElementById('app-container').classList.remove('show-reader');
        }

        // --- Audio Logic ---
        function playSpecificAyah(index) {
            currentAyahIndex = index;
            loadAndPlay();
        }

        function loadAndPlay() {
            if (!currentSurahData.length) return;
            
            const ayah = currentSurahData[currentAyahIndex];
            audioEl.src = ayah.audioUrl;
            
            // Highlight Card
            document.querySelectorAll('.ayah-card').forEach(c => c.classList.remove('active-ayah'));
            const card = document.getElementById(`ayah-${currentAyahIndex}`);
            if (card) {
                card.classList.add('active-ayah');
                card.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }

            audioEl.play().catch(e => console.log("Playback failed", e));
            isPlaying = true;
            updatePlayBtn();
            updatePlayerInfo();
        }

        function togglePlay() {
            if (!audioEl.src && currentSurahData.length > 0) {
                loadAndPlay();
                return;
            }
            
            if (audioEl.paused) {
                audioEl.play();
                isPlaying = true;
            } else {
                audioEl.pause();
                isPlaying = false;
            }
            updatePlayBtn();
        }

        function nextAyah() {
            if (currentAyahIndex < currentSurahData.length - 1) {
                currentAyahIndex++;
                loadAndPlay();
            }
        }

        function prevAyah() {
            if (currentAyahIndex > 0) {
                currentAyahIndex--;
                loadAndPlay();
            }
        }

        function updatePlayBtn() {
            const btn = document.getElementById('play-btn');
            btn.innerHTML = isPlaying? '<i class="fas fa-pause"></i>' : '<i class="fas fa-play"></i>';
        }

        function updatePlayerInfo() {
            if (currentSurahData[currentAyahIndex]) {
                document.getElementById('audio-subtitle').innerText = `Ayah ${currentSurahData[currentAyahIndex].number}`;
                document.getElementById('audio-title').innerText = document.getElementById('header-title').textContent;
            }
        }

        // Auto Play Next
        audioEl.onended = () => {
            if (currentAyahIndex < currentSurahData.length - 1) {
                currentAyahIndex++;
                loadAndPlay();
            } else {
                isPlaying = false;
                updatePlayBtn();
            }
        };

    </script>
</body>
</html>
