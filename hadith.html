<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HamzaEditz 2.0 - Daily Hadith</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Poppins Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
    <!-- Feather Icons -->
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
    <style>
        :root {
            --primary-gradient: linear-gradient(90deg, #8E2DE2, #4A00E0);
            --primary-color: #8E2DE2;
            --bg-dark: #0f0f12;
            --bg-light: #1f1f1f;
            --bg-lighter: #2a2a2a;
            --border-color: #333;
        }

        /* --- Gemini Text Effect --- */
        .gemini-title {
            font-weight: 800;
            background: linear-gradient(90deg, #8E2DE2, #4A00E0, #ec4899, #f59e0b, #8E2DE2);
            background-size: 400% 100%;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gemini-shimmer 8s linear infinite;
        }
        @keyframes gemini-shimmer {
            0% { background-position: 0% 50%; }
            100% { background-position: 400% 50%; }
        }
        /* --- End Gemini Effect --- */

        /* Gradient Button */
        .btn-gradient {
            background: var(--primary-gradient);
            border-color: var(--primary-color);
            transition: opacity 0.2s;
        }
        .btn-gradient:hover:not(:disabled) {
            opacity: 0.9;
        }
        
        /* Collection Button Base Style */
        .collection-button {
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            color: #d1d5db; /* gray-300 */
            transition: all 0.2s;
        }
        .collection-button:hover:not(:disabled) {
            border-color: var(--primary-color);
            color: #fff;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Poppins', 'sans-serif'], // Use Poppins
                    },
                    colors: {
                        'primary-color': 'var(--primary-color)',
                        'bg-dark': 'var(--bg-dark)',
                        'bg-light': 'var(--bg-light)',
                        'bg-lighter': 'var(--bg-lighter)',
                        'border-color': 'var(--border-color)',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-bg-dark text-gray-100 min-h-screen p-4 sm:p-8 font-sans">

    <div class="max-w-4xl mx-auto space-y-8">
        
        <!-- Header -->
        <header class="text-center py-4 border-b border-border-color">
            <h1 class="text-4xl sm:text-5xl font-extrabold gemini-title">
                Hadith
            </h1>
            <p class="text-gray-400 mt-2 text-lg">Learn something new from the deen every day ðŸ’–âœ¨

</p>
        </header>

        <!-- Collection Selection Buttons -->
        <div id="buttonContainer" class="grid grid-cols-2 sm:grid-cols-5 gap-3 sm:gap-4">
            <!-- Buttons will be generated here by JS -->
        </div>

        <!-- Hadith Display Card -->
        <main id="hadithContainer" class="bg-bg-light p-6 sm:p-10 rounded-xl shadow-2xl border-t-4 border-primary-color space-y-6">
            <p id="loadingMessage" class="text-center text-xl text-primary-color font-medium">
                Loading a random Hadith...
            </p>
            
            <div id="hadithContent" class="hidden space-y-6">
                <!-- Hadith content will be displayed here -->
            </div>
        </main>
    </div>

    <script>
        // API Endpoints
        const API_BASE_URL = "https://random-hadith-generator.vercel.app/";
        const COLLECTIONS = {
            'Bukhari': 'bukhari',
            'Muslim': 'muslim',
            'Tirmidhi': 'tirmidhi',
            'IbnMajah': 'ibnmajah',
            'Abu Dawud': 'abudawud'
        };

        // UI Elements
        const hadithContainer = document.getElementById('hadithContainer');
        const loadingMessage = document.getElementById('loadingMessage');
        const hadithContent = document.getElementById('hadithContent');
        const buttonContainer = document.getElementById('buttonContainer');
        
        let currentCollection = 'Bukhari'; // Default to Bukhari on load

        /**
         * Cleans up newline and tab characters from API strings.
         */
        function cleanString(str) {
            return str ? str.replace(/[\n\t]/g, '').trim() : '';
        }

        /**
         * Sets the loading state of the UI and buttons.
         */
        function setLoading(isLoading) {
            const buttons = buttonContainer.querySelectorAll('button');
            buttons.forEach(btn => {
                btn.disabled = isLoading;
            });

            if (isLoading) {
                hadithContent.classList.add('hidden');
                loadingMessage.classList.remove('hidden');
                loadingMessage.innerHTML = `
                    <i data-feather="loader" class="animate-spin h-6 w-6 inline mr-3 text-primary-color"></i>
                    Loading a random ${currentCollection} Hadith...
                `;
                // Render the new icon
                feather.replace();
            } else {
                loadingMessage.classList.add('hidden');
            }
        }

        /**
         * Displays the fetched Hadith data in the UI.
         */
        function displayHadith(hadithData) {
            setLoading(false);
            
            const bookName = cleanString(hadithData.bookName);
            const chapterName = cleanString(hadithData.chapterName);
            const header = cleanString(hadithData.header);
            const hadithText = cleanString(hadithData.hadith_english);
            const refNo = hadithData.refno;
            const collection = hadithData.book;

            hadithContent.innerHTML = `
                <!-- Reference & Book -->
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center border-b border-border-color pb-3">
                    <p class="text-2xl font-bold text-primary-color">${collection}</p>
                    <p class="text-lg font-mono text-gray-400 mt-1 sm:mt-0">${refNo}</p>
                </div>

                <!-- Book and Chapter -->
                <div class="space-y-2">
                    <h3 class="text-xl font-semibold text-gray-100">
                        ${bookName}
                    </h3>
                    <p class="text-gray-400 italic text-md">
                        <span class="font-bold text-gray-300">Chapter:</span> ${chapterName}
                    </p>
                </div>

                <!-- Hadith Text -->
                <div class="space-y-4 pt-4 border-t border-border-color">
                    <p class="text-gray-300 font-medium">${header}</p>
                    <p class="text-2xl font-sans leading-relaxed text-gray-100">
                        "${hadithText}"
                    </p>
                </div>
            `;
            hadithContent.classList.remove('hidden');
        }

        /**
         * Fetches a random Hadith from the specified collection.
         */
        async function fetchHadith(collection) {
            currentCollection = Object.keys(COLLECTIONS).find(key => COLLECTIONS[key] === collection);
            setLoading(true);
            
            // Highlight the active button
            document.querySelectorAll('.collection-button').forEach(btn => {
                btn.classList.remove('btn-gradient', 'text-white', 'active');
                if (btn.dataset.collection === collection) {
                    btn.classList.add('btn-gradient', 'text-white', 'active');
                }
            });

            try {
                // Use a CORS proxy to prevent potential errors
                const response = await fetch(`https://corsproxy.io/?${encodeURIComponent(API_BASE_URL + collection)}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }

                const json = await response.json();
                
                if (json && json.data) {
                    displayHadith(json.data);
                } else {
                    throw new Error("Invalid response structure or missing data.");
                }

            } catch (error) {
                setLoading(false);
                hadithContent.classList.add('hidden');
                loadingMessage.classList.remove('hidden');
                loadingMessage.innerHTML = `
                    <p class="text-red-500 text-center text-xl">
                        Error fetching Hadith: ${error.message}. Please try again.
                    </p>
                `;
                console.error("Fetch Hadith Error:", error);
            }
        }

        /**
         * Initializes the buttons and attaches event listeners.
         */
        function initializeButtons() {
            Object.entries(COLLECTIONS).forEach(([name, key]) => {
                const button = document.createElement('button');
                button.textContent = name;
                button.className = `collection-button w-full p-3 font-semibold rounded-lg disabled:opacity-50 disabled:cursor-not-allowed text-base`;
                button.dataset.collection = key;
                button.onclick = () => fetchHadith(key);
                buttonContainer.appendChild(button);
            });
        }

        // Initialize and load the first Hadith on page load
        document.addEventListener('DOMContentLoaded', () => {
            initializeButtons();
            // Load a random Hadith from Bukhari by default
            fetchHadith(COLLECTIONS['Bukhari']);
            // Render any icons
            feather.replace();
        });

    </script>
</body>
</html>

